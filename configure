#!/bin/sh

prefix=/usr/local
opt=true
dbg=true

for arg; do
	case $arg in
	--prefix=*)
		prefix=`echo $arg | sed 's/--prefix=//'`
		;;
	--enable-opt)
		opt=true
		;;
	--disable-opt)
		opt=false
		;;
	--enable-dbg)
		dbg=true
		;;
	--disable-dbg)
		dbg=false
		;;
	esac
done

check_header()
{
	if echo "#include <$2>" | cpp >/dev/null 2>&1; then
		echo "Looking for $2 ... OK"
		eval have_$1=true
	else
		echo "Looking for $2 ... not found"
		eval have_$1=false
	fi
}

check_header xrandr X11/extensions/Xrandr.h


echo 'Generating Makefile ...'
echo '# Generated by configure, do not edit. Edit Makefile.in instead' >Makefile
echo "PREFIX = $prefix" >>Makefile

$opt && echo 'opt = -O3' >>Makefile
$dbg && echo 'dbg = -g' >>Makefile

if $have_xrandr; then
	echo 'CFLAGS_xrandr = -DHAVE_XRANDR' >>Makefile
	echo 'LDFLAGS_xrandr = -lXrandr' >>Makefile
fi

cat Makefile.in >>Makefile
